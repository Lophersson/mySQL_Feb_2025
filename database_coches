--------- BASE DE DATOS ORIGINAL VISTA EN CLASE ---------

CREATE DATABASE IF NOT EXISTS COCHES;
USE COCHES;

CREATE TABLE COCHE (
    MATRICULA VARCHAR(20) NOT NULL,
    MARCA VARCHAR(50) NOT NULL,
    MODELO VARCHAR(50) NOT NULL,
    COLOR VARCHAR(50) NOT NULL,
    PRECIO_VENTA DECIMAL(10,2) NOT NULL,
    CLIENTE_ID VARCHAR(20),
    CONSTRAINT PK_COCHE PRIMARY KEY (MATRICULA),
    CONSTRAINT FK_COCHE_CLIENTE FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTE(RFC) ON DELETE SET NULL
);

CREATE TABLE REVISION (
    CODIGO VARCHAR(20) NOT NULL,
    COCHE_ID VARCHAR(20) NOT NULL,
    FILTRO VARCHAR(50) NOT NULL,
    ACEITE VARCHAR(50) NOT NULL,
    FRENOS VARCHAR(50) NOT NULL,
    CONSTRAINT PK_REVISION PRIMARY KEY (CODIGO),
    CONSTRAINT FK_REVISION_COCHE FOREIGN KEY (COCHE_ID) REFERENCES COCHE(MATRICULA) ON DELETE CASCADE
);

CREATE TABLE CLIENTE (
    RFC VARCHAR(32) NOT NULL,
    TELEFONO VARCHAR(50) NOT NULL,
    CODIGO_INTERNO VARCHAR(20) NOT NULL,
    NOMBRE VARCHAR(100) NOT NULL,
    DIRECCION VARCHAR(100) NOT NULL,
    CIUDAD VARCHAR(50) NOT NULL,
    COCHE_MATRICULA VARCHAR(20) NOT NULL,    
    CONSTRAINT PK_CLIENTE PRIMARY KEY (RFC)
);
CREATE UNIQUE INDEX CC_CLIENTE_CC1 ON CLIENTE(CODIGO_INTERNO);

CREATE TABLE R_PASA (
	COCHE_MATRICULA VARCHAR(20) NOT NULL,
    REVISION_CODIGO VARCHAR(32) NOT NULL,
    CONSTRAINT PK_R_PASA PRIMARY KEY (COCHE_MATRICULA, REVISION_CODIGO)
);

ALTER TABLE CLIENTE
ADD CONSTRAINT FK_CLIENTE_CE1
FOREIGN KEY (COCHE_MATRICULA) REFERENCES COCHE(MATRICULA);

ALTER TABLE R_PASA
ADD CONSTRAINT FK_R_PASA_CE1
FOREIGN KEY (COCHE_MATRICULA) REFERENCES COCHE(MATRICULA);

ALTER TABLE R_PASA
ADD CONSTRAINT FK_R_PASA_CE2
FOREIGN KEY (REVISION_CODIGO) REFERENCES REVISION(CODIGO);

DROP TABLE IF EXISTS COCHE;
DROP TABLE IF EXISTS REVISION;
DROP TABLE IF EXISTS CLIENTE;
DROP TABLE IF EXISTS R_PASA;
---

--------- BASE DE DATOS MODIFICADA ---------
  
CREATE DATABASE IF NOT EXISTS COCHES;
USE COCHES;

CREATE TABLE CLIENTE (
    RFC VARCHAR(32) NOT NULL,
    TELEFONO VARCHAR(50) NOT NULL,
    CODIGO_INTERNO VARCHAR(20) NOT NULL,
    NOMBRE VARCHAR(100) NOT NULL,
    DIRECCION VARCHAR(100) NOT NULL,
    CIUDAD VARCHAR(50) NOT NULL,
    COCHE_MATRICULA VARCHAR(20) NOT NULL,    
    CONSTRAINT PK_CLIENTE PRIMARY KEY (RFC)
);

CREATE UNIQUE INDEX CC_CLIENTE_CC1 ON CLIENTE(CODIGO_INTERNO);

CREATE TABLE COCHE (
    MATRICULA VARCHAR(20) NOT NULL,
    MARCA VARCHAR(50) NOT NULL,
    MODELO VARCHAR(50) NOT NULL,
    COLOR VARCHAR(50) NOT NULL,
    PRECIO_VENTA DECIMAL(10,2) NOT NULL,
    CLIENTE_ID VARCHAR(20),
    CONSTRAINT PK_COCHE PRIMARY KEY (MATRICULA),
    CONSTRAINT FK_COCHE_CLIENTE FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTE(RFC) ON DELETE SET NULL
);

CREATE TABLE REVISION (
    CODIGO VARCHAR(20) NOT NULL,
    COCHE_ID VARCHAR(20) NOT NULL,
    FILTRO VARCHAR(50) NOT NULL,
    ACEITE VARCHAR(50) NOT NULL,
    FRENOS VARCHAR(50) NOT NULL,
    CONSTRAINT PK_REVISION PRIMARY KEY (CODIGO),
    CONSTRAINT FK_REVISION_COCHE FOREIGN KEY (COCHE_ID) REFERENCES COCHE(MATRICULA) ON DELETE CASCADE
);

CREATE TABLE R_PASA (
    COCHE_MATRICULA VARCHAR(20) NOT NULL,
    REVISION_CODIGO VARCHAR(32) NOT NULL,
    CONSTRAINT PK_R_PASA PRIMARY KEY (COCHE_MATRICULA, REVISION_CODIGO)
);

ALTER TABLE CLIENTE
ADD CONSTRAINT FK_CLIENTE_CE1
FOREIGN KEY (COCHE_MATRICULA) REFERENCES COCHE(MATRICULA);

ALTER TABLE R_PASA
ADD CONSTRAINT FK_R_PASA_CE1
FOREIGN KEY (COCHE_MATRICULA) REFERENCES COCHE(MATRICULA);

ALTER TABLE R_PASA
ADD CONSTRAINT FK_R_PASA_CE2
FOREIGN KEY (REVISION_CODIGO) REFERENCES REVISION(CODIGO);
